<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StorageClass Ranking</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f5f5; color: #333; }
    .header { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: white; padding: 2rem; }
    .header h1 { font-size: 1.8rem; margin-bottom: 0.3rem; }
    .header .meta { color: #aaa; font-size: 0.85rem; }
    .methodology { background: white; border-radius: 8px; padding: 1.5rem 2rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 1.5rem; line-height: 1.6; font-size: 0.92rem; color: #444; }
    .methodology h2 { font-size: 1.15rem; color: #1a1a2e; margin: 0 0 0.8rem 0; padding: 0; border: none; }
    .methodology p { margin: 0 0 0.7rem 0; }
    .methodology p:last-child { margin-bottom: 0; }
    .methodology .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.3rem 2rem; margin: 0.5rem 0; font-size: 0.88rem; }
    .methodology .detail-grid dt { color: #777; }
    .methodology .detail-grid dd { font-weight: 500; margin: 0; }
    .container { max-width: 1400px; margin: 0 auto; padding: 1.5rem; }
    .section { margin-bottom: 2rem; }
    .section h2 { font-size: 1.3rem; color: #1a1a2e; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #e0e0e0; }
    .card { background: white; border-radius: 8px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 1rem; }
    table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
    th, td { padding: 0.6rem 0.8rem; text-align: left; border-bottom: 1px solid #eee; }
    th { background: #f8f9fa; font-weight: 600; position: sticky; top: 0; }
    .num { text-align: right; }
    .rank-1 td { background: #fff9e6; }
    .rank-2 td { background: #f5f5f5; }
    .rank-3 td { background: #fdf0ed; }
    .score-bar { display: inline-block; height: 20px; border-radius: 3px; vertical-align: middle; min-width: 2px; }
    .chart-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 1rem; }
    .collapsible { cursor: pointer; user-select: none; }
    .collapsible::after { content: ' [+]'; font-size: 0.8rem; color: #999; }
    .collapsible.open::after { content: ' [-]'; }
    .collapse-content { display: none; }
    .collapse-content.open { display: block; }
    .weight-badge { display: inline-block; background: #e0e0e0; color: #555; font-size: 0.7rem; padding: 0.15rem 0.4rem; border-radius: 3px; margin-left: 0.5rem; }
  </style>
</head>
<body>
  <div class="header">
    <h1>StorageClass Performance Ranking</h1>
    <div class="meta" id="meta"></div>
  </div>
  <div class="container">
    <div class="methodology" id="methodology"></div>
  </div>
  <div class="container">
    <div class="section">
      <h2 class="collapsible open" onclick="toggleCollapse(this)">About the StorageClasses</h2>
      <div class="collapse-content open">
        <div class="card"><table id="poolInfoTable"></table></div>
      </div>
    </div>
    <div class="section">
      <h2 class="collapsible open" onclick="toggleCollapse(this)">About the Workloads</h2>
      <div class="collapse-content open">
        <div class="card"><table id="workloadInfoTable"></table></div>
      </div>
    </div>
    <div class="section">
      <h2>Overall Composite Ranking</h2>
      <div class="card">
        <table id="compositeTable"></table>
      </div>
      <div class="card"><canvas id="compositeChart" height="80"></canvas></div>
    </div>
    <div class="section">
      <h2>Per-Workload Rankings</h2>
      <div class="chart-grid" id="workloadCharts"></div>
    </div>
    <div class="section">
      <h2>Latency Ranking (Random 4k)</h2>
      <div class="card">
        <table id="latencyTable"></table>
      </div>
    </div>
    <div class="section">
      <h2 class="collapsible" onclick="toggleCollapse(this)">Raw Data</h2>
      <div class="collapse-content">
        <div class="card"><table id="rawTable"></table></div>
      </div>
    </div>
  </div>
  <script>
    const DATA = {"pools": ["cephfs-rep2", "cephfs-rep3", "ec-2-1", "rep2", "rep3", "rep3-enc", "rep3-virt"], "workload_rankings": [{"id": "random_iops", "title": "Random 4k IOPS", "higher_better": true, "ranking": [{"pool": "rep2", "value": 68976.0, "total_iops": 68976, "read_iops": 60021, "write_iops": 8955}, {"pool": "rep3", "value": 63356.0, "total_iops": 63356, "read_iops": 55841, "write_iops": 7515}, {"pool": "rep3-enc", "value": 61062.0, "total_iops": 61062, "read_iops": 53443, "write_iops": 7619}, {"pool": "cephfs-rep2", "value": 58326.0, "total_iops": 58326, "read_iops": 54434, "write_iops": 3892}, {"pool": "cephfs-rep3", "value": 55474.0, "total_iops": 55474, "read_iops": 52439, "write_iops": 3035}, {"pool": "ec-2-1", "value": 45987.0, "total_iops": 45987, "read_iops": 40607, "write_iops": 5380}]}, {"id": "seq_bw", "title": "Sequential 1M Throughput", "higher_better": true, "ranking": [{"pool": "rep3", "value": 7966.47, "total_mib": 7966.5, "read_mib": 5298.2, "write_mib": 2668.2}, {"pool": "rep2", "value": 7900.31, "total_mib": 7900.3, "read_mib": 5761.7, "write_mib": 2138.7}, {"pool": "rep3-virt", "value": 7619.09, "total_mib": 7619.1, "read_mib": 5187.9, "write_mib": 2431.2}, {"pool": "rep3-enc", "value": 6992.06, "total_mib": 6992.1, "read_mib": 4530.1, "write_mib": 2462.0}, {"pool": "cephfs-rep3", "value": 5367.36, "total_mib": 5367.4, "read_mib": 4343.2, "write_mib": 1024.2}, {"pool": "cephfs-rep2", "value": 5264.55, "total_mib": 5264.5, "read_mib": 4334.3, "write_mib": 930.2}, {"pool": "ec-2-1", "value": 4214.26, "total_mib": 4214.3, "read_mib": 2790.4, "write_mib": 1423.8}]}, {"id": "mixed_iops", "title": "Mixed 70/30 4k IOPS", "higher_better": true, "ranking": [{"pool": "rep3-enc", "value": 52206.0, "total_iops": 52206, "read_iops": 36522, "write_iops": 15684}, {"pool": "rep2", "value": 50216.0, "total_iops": 50216, "read_iops": 35129, "write_iops": 15087}, {"pool": "rep3-virt", "value": 47138.0, "total_iops": 47138, "read_iops": 32973, "write_iops": 14165}, {"pool": "rep3", "value": 47052.0, "total_iops": 47052, "read_iops": 32913, "write_iops": 14139}, {"pool": "cephfs-rep2", "value": 44733.0, "total_iops": 44733, "read_iops": 31291, "write_iops": 13442}, {"pool": "cephfs-rep3", "value": 36711.0, "total_iops": 36711, "read_iops": 25673, "write_iops": 11038}, {"pool": "ec-2-1", "value": 25996.0, "total_iops": 25996, "read_iops": 18177, "write_iops": 7819}]}], "latency_ranking": [{"pool": "rep2", "read_lat_avg": 1.065, "write_lat_avg": 7.14, "read_p99": 2.21, "write_p99": 154.14, "avg_p99": 78.175}, {"pool": "rep3", "read_lat_avg": 1.145, "write_lat_avg": 8.55, "read_p99": 2.175, "write_p99": 189.79, "avg_p99": 95.983}, {"pool": "rep3-enc", "read_lat_avg": 1.195, "write_lat_avg": 8.395, "read_p99": 2.24, "write_p99": 193.985, "avg_p99": 98.113}, {"pool": "ec-2-1", "read_lat_avg": 1.575, "write_lat_avg": 11.885, "read_p99": 2.8, "write_p99": 278.92, "avg_p99": 140.86}, {"pool": "cephfs-rep2", "read_lat_avg": 1.175, "write_lat_avg": 16.915, "read_p99": 2.995, "write_p99": 608.17, "avg_p99": 305.582}, {"pool": "cephfs-rep3", "read_lat_avg": 1.215, "write_lat_avg": 21.065, "read_p99": 2.995, "write_p99": 750.78, "avg_p99": 376.887}], "composite": [{"pool": "rep2", "score": 99.0, "breakdown": {"random_iops": 100.0, "seq_bw": 99.2, "mixed_iops": 96.2, "p99_lat": 100.0}}, {"pool": "rep3-virt", "score": 93.5, "breakdown": {"seq_bw": 95.6, "mixed_iops": 90.3}}, {"pool": "rep3", "score": 92.3, "breakdown": {"random_iops": 91.9, "seq_bw": 100.0, "mixed_iops": 90.1, "p99_lat": 74.8}}, {"pool": "rep3-enc", "score": 88.8, "breakdown": {"random_iops": 88.5, "seq_bw": 87.8, "mixed_iops": 100.0, "p99_lat": 70.6}}, {"pool": "cephfs-rep2", "score": 73.0, "breakdown": {"random_iops": 84.6, "seq_bw": 66.1, "mixed_iops": 85.7, "p99_lat": 21.6}}, {"pool": "cephfs-rep3", "score": 68.1, "breakdown": {"random_iops": 80.4, "seq_bw": 67.4, "mixed_iops": 70.3, "p99_lat": 16.6}}, {"pool": "ec-2-1", "score": 56.2, "breakdown": {"random_iops": 66.7, "seq_bw": 52.9, "mixed_iops": 49.8, "p99_lat": 37.0}}], "weights": {"random_iops": 0.4, "seq_bw": 0.3, "mixed_iops": 0.2, "p99_lat": 0.1}, "pool_info": [{"name": "cephfs-rep2", "type": "ODF CephFS Replicated 2-way", "description": "Ceph Filesystem with 2x replicated data pool. Uses file-on-filesystem indirection in KubeVirt.", "vsan": "vSAN File Service (RAID-1, FTT=1)", "overhead": "2x (data) + 3x (metadata)"}, {"name": "cephfs-rep3", "type": "ODF CephFS Replicated 3-way", "description": "Ceph Filesystem with 3x replicated data pool. Uses file-on-filesystem indirection in KubeVirt.", "vsan": "vSAN File Service (RAID-1, FTT=2)", "overhead": "3x (data) + 3x (metadata)"}, {"name": "ec-2-1", "type": "ODF Erasure Coded 2+1", "description": "Ceph RBD with erasure coding (2 data + 1 coding chunks). Better space efficiency than replication.", "vsan": "RAID-5, FTT=1", "overhead": "1.5x"}, {"name": "rep2", "type": "ODF Replicated 2-way", "description": "Ceph RBD block storage with 2x replication across failure domains.", "vsan": "RAID-1, FTT=1", "overhead": "2x"}, {"name": "rep3", "type": "ODF Replicated 3-way", "description": "Ceph RBD block storage with 3x replication across failure domains.", "vsan": "RAID-1, FTT=2", "overhead": "3x"}, {"name": "rep3-enc", "type": "ODF Replicated 3-way", "description": "Ceph RBD block storage with 3x replication across failure domains. (encrypted at-rest via LUKS)", "vsan": "RAID-1, FTT=2", "overhead": "3x"}, {"name": "rep3-virt", "type": "ODF Replicated 3-way", "description": "Ceph RBD block storage with 3x replication across failure domains. (VM-optimized SC with write-back caching features)", "vsan": "RAID-1, FTT=2", "overhead": "3x"}], "test_config": {"vm_size": "medium", "pvc_size": "150Gi", "concurrency": "1"}};
    const RUN_ID = "perf-20260228-164717";
    const CLUSTER_DESC = "IBM Cloud ROKS (bx2d.metal.96x384 bare metal, NVMe, 3 workers, 3 AZs in us-south)";
    const CLUSTER_ZONES_STR = "us-south-1,us-south-2,us-south-3 (multi-AZ=true)";
    const COLORS = ['#e63946','#457b9d','#2a9d8f','#e9c46a','#f4a261','#264653',
                    '#a8dadc','#d62828','#023e8a','#780000','#6a4c93','#1982c4',
                    '#8ac926','#ff595e','#ffca3a'];
    // Header meta (run ID only)
    document.getElementById('meta').textContent = 'Run: ' + RUN_ID + ' | ' + CLUSTER_DESC + ' | Zones: ' + CLUSTER_ZONES_STR;

    // Methodology write-up
    (function() {
      const cfg = DATA.test_config || {};
      const pools = (DATA.pool_info || []).length;
      let html = '<h2>How This Report Works</h2>';
      html += '<p>This report ranks <strong>' + pools + ' StorageClasses</strong> by running the same set of I/O benchmarks against each one under identical conditions, then combining the results into a single composite score. The goal is to answer: <em>which StorageClass gives the best overall performance for VM workloads on this cluster?</em></p>';
      html += '<p><strong>What was tested:</strong> Each StorageClass was provisioned as a ' + (cfg.pvc_size || '150Gi') + ' data disk attached to a ' + (cfg.vm_size || 'small') + ' VM (2 vCPU, 4 GiB RAM). Three fio benchmarks were run on each disk:</p>';
      html += '<ul style="margin:0.3rem 0 0.7rem 1.5rem">';
      html += '<li><strong>Random 4k IOPS</strong> — measures how many small I/O operations per second the storage can handle (IOPS). This is what matters for databases and general VM activity.</li>';
      html += '<li><strong>Sequential 1M Throughput</strong> — measures raw data transfer speed (throughput in MiB/s). This is what matters for backups, large file copies, and data pipelines.</li>';
      html += '<li><strong>Mixed 70/30 4k IOPS</strong> — a realistic blend of 70% reads and 30% writes that simulates everyday application workloads like web servers and file shares.</li>';
      html += '</ul>';
      html += '<p><strong>How scoring works:</strong> Each StorageClass is scored 0-100 on each workload (100 = best performer). These are combined into a weighted composite score:</p>';
      html += '<dl class="detail-grid">';
      html += '<dt>Random 4k IOPS</dt><dd>40% weight — most impactful for general VM performance</dd>';
      html += '<dt>Sequential 1M throughput</dt><dd>30% weight — important for data-heavy workloads</dd>';
      html += '<dt>Mixed 70/30 IOPS</dt><dd>20% weight — reflects real-world application patterns</dd>';
      html += '<dt>p99 latency (lower is better)</dt><dd>10% weight — tail latency from random 4k I/O, weighted by throughput so pools doing fewer IOPS don\'t get an unfair advantage</dd>';
      html += '</dl>';
      html += '<p style="margin-top:0.5rem"><strong>Test parameters:</strong> Each benchmark ran for 60 seconds with a 10-second warmup, using direct I/O (O_DIRECT, bypassing OS cache), I/O depth of 32, and 4 parallel worker threads per job. All tests used a single VM with concurrency of ' + (cfg.concurrency || '1') + '.</p>';
      document.getElementById('methodology').innerHTML = html;
    })();

    // Pool info table
    (function() {
      const info = DATA.pool_info || [];
      if (!info.length) return;
      let html = '<thead><tr><th>StorageClass</th><th>Type</th><th>vSAN Equivalent</th><th>Storage Overhead</th><th>Description</th></tr></thead><tbody>';
      info.forEach(p => {
        html += '<tr><td><strong>' + p.name + '</strong></td><td>' + p.type + '</td><td>' + p.vsan + '</td><td>' + p.overhead + '</td><td>' + p.description + '</td></tr>';
      });
      html += '</tbody>';
      document.getElementById('poolInfoTable').innerHTML = html;
    })();

    // Workload info table
    (function() {
      const workloads = [
        { name: 'Random 4k IOPS', bs: '4k', desc: 'Small-block random I/O — measures IOPS capacity. Typical of databases and VM disk activity.' },
        { name: 'Sequential 1M Throughput', bs: '1M', desc: 'Large-block sequential I/O — measures bandwidth/throughput. Typical of backups and bulk data transfer.' },
        { name: 'Mixed 70/30 4k IOPS', bs: '4k', desc: '70% reads / 30% writes — simulates typical application workloads like web apps and file servers.' },
        { name: 'p99 Tail Latency', bs: '4k', desc: 'Derived from the Random 4k test. The 99th percentile I/O response time — 99% of operations complete faster than this. Lower is better. Measures worst-case storage responsiveness.' },
      ];
      let html = '<thead><tr><th>Workload</th><th>Block Size</th><th>What It Measures</th></tr></thead><tbody>';
      workloads.forEach(w => {
        html += '<tr><td><strong>' + w.name + '</strong></td><td>' + w.bs + '</td><td>' + w.desc + '</td></tr>';
      });
      html += '</tbody>';
      document.getElementById('workloadInfoTable').innerHTML = html;
    })();

    // Composite table
    (function() {
      const comp = DATA.composite;
      let html = '<thead><tr><th>Rank</th><th>StorageClass</th><th class="num">Composite Score</th>';
      html += '<th class="num">Random 4k IOPS<span class="weight-badge">40%</span></th>';
      html += '<th class="num">Sequential 1M BW<span class="weight-badge">30%</span></th>';
      html += '<th class="num">Mixed 70/30 IOPS<span class="weight-badge">20%</span></th>';
      html += '<th class="num">p99 Latency<span class="weight-badge">10%</span></th>';
      html += '</tr></thead><tbody>';
      comp.forEach((c, i) => {
        const cls = i < 3 ? ' class="rank-' + (i+1) + '"' : '';
        html += '<tr' + cls + '><td>#' + (i+1) + '</td>';
        html += '<td><strong>' + c.pool + '</strong></td>';
        html += '<td class="num">' + c.score + '</td>';
        const dims = ['random_iops', 'seq_bw', 'mixed_iops', 'p99_lat'];
        dims.forEach(d => {
          const v = c.breakdown[d] !== undefined ? c.breakdown[d] : '-';
          html += '<td class="num">' + v + '</td>';
        });
        html += '</tr>';
      });
      html += '</tbody>';
      document.getElementById('compositeTable').innerHTML = html;
    })();

    // Composite bar chart
    (function() {
      const comp = DATA.composite;
      new Chart(document.getElementById('compositeChart'), {
        type: 'bar',
        data: {
          labels: comp.map(c => c.pool),
          datasets: [{
            label: 'Composite Score',
            data: comp.map(c => c.score),
            backgroundColor: comp.map((_, i) => COLORS[i % COLORS.length]),
          }]
        },
        options: {
          indexAxis: 'y',
          responsive: true,
          plugins: { legend: { display: false } },
          scales: {
            x: { beginAtZero: true, max: 105, title: { display: true, text: 'Score (best = 100)' } },
          }
        }
      });
    })();

    // Per-workload charts and tables
    (function() {
      const container = document.getElementById('workloadCharts');
      DATA.workload_rankings.forEach((wl, wi) => {
        const card = document.createElement('div');
        card.className = 'card';
        const unit = wl.id === 'seq_bw' ? 'MiB/s' : 'IOPS';
        const valKey = wl.id === 'seq_bw' ? 'total_mib' : 'total_iops';
        const readKey = wl.id === 'seq_bw' ? 'read_mib' : 'read_iops';
        const writeKey = wl.id === 'seq_bw' ? 'write_mib' : 'write_iops';

        let html = '<h3 style="margin-bottom:0.5rem">' + wl.title + '</h3>';
        html += '<table><thead><tr><th>Rank</th><th>StorageClass</th><th class="num">Total ' + unit + '</th>';
        html += '<th class="num">Read</th><th class="num">Write</th></tr></thead><tbody>';
        wl.ranking.forEach((r, i) => {
          const cls = i < 3 ? ' class="rank-' + (i+1) + '"' : '';
          html += '<tr' + cls + '><td>#' + (i+1) + '</td>';
          html += '<td>' + r.pool + '</td>';
          html += '<td class="num"><strong>' + (r[valKey] !== undefined ? r[valKey].toLocaleString() : r.value) + '</strong></td>';
          html += '<td class="num">' + (r[readKey] !== undefined ? r[readKey].toLocaleString() : '-') + '</td>';
          html += '<td class="num">' + (r[writeKey] !== undefined ? r[writeKey].toLocaleString() : '-') + '</td>';
          html += '</tr>';
        });
        html += '</tbody></table>';

        const canvasId = 'wlChart' + wi;
        html += '<canvas id="' + canvasId + '" height="60" style="margin-top:0.5rem"></canvas>';
        card.innerHTML = html;
        container.appendChild(card);

        new Chart(document.getElementById(canvasId), {
          type: 'bar',
          data: {
            labels: wl.ranking.map(r => r.pool),
            datasets: [
              { label: 'Read', data: wl.ranking.map(r => r[readKey] || 0), backgroundColor: '#457b9d' },
              { label: 'Write', data: wl.ranking.map(r => r[writeKey] || 0), backgroundColor: '#e63946' },
            ]
          },
          options: {
            indexAxis: 'y',
            responsive: true,
            plugins: { legend: { position: 'top' } },
            scales: { x: { beginAtZero: true, stacked: true, title: { display: true, text: unit } }, y: { stacked: true } }
          }
        });
      });
    })();

    // Latency table
    (function() {
      const lat = DATA.latency_ranking;
      let html = '<thead><tr><th>Rank</th><th>StorageClass</th><th class="num">Read Avg (ms)</th>';
      html += '<th class="num">Write Avg (ms)</th><th class="num">Read p99 (ms)</th><th class="num">Write p99 (ms)</th>';
      html += '<th class="num">Avg p99 (ms)</th></tr></thead><tbody>';
      lat.forEach((r, i) => {
        const cls = i < 3 ? ' class="rank-' + (i+1) + '"' : '';
        html += '<tr' + cls + '><td>#' + (i+1) + '</td>';
        html += '<td>' + r.pool + '</td>';
        html += '<td class="num">' + r.read_lat_avg + '</td><td class="num">' + r.write_lat_avg + '</td>';
        html += '<td class="num">' + r.read_p99 + '</td><td class="num">' + r.write_p99 + '</td>';
        html += '<td class="num"><strong>' + r.avg_p99 + '</strong></td></tr>';
      });
      html += '</tbody>';
      document.getElementById('latencyTable').innerHTML = html;
    })();

    // Raw data table (from composite + workload data)
    (function() {
      const comp = DATA.composite;
      const wls = DATA.workload_rankings;
      let html = '<thead><tr><th>StorageClass</th><th class="num">Composite</th>';
      wls.forEach(wl => { html += '<th class="num">' + wl.title + '</th>'; });
      html += '<th class="num">Avg p99 (ms)</th></tr></thead><tbody>';
      comp.forEach(c => {
        html += '<tr><td>' + c.pool + '</td><td class="num">' + c.score + '</td>';
        wls.forEach(wl => {
          const entry = wl.ranking.find(r => r.pool === c.pool);
          html += '<td class="num">' + (entry ? entry.value : '-') + '</td>';
        });
        const latEntry = DATA.latency_ranking.find(r => r.pool === c.pool);
        html += '<td class="num">' + (latEntry ? latEntry.avg_p99 : '-') + '</td>';
        html += '</tr>';
      });
      html += '</tbody>';
      document.getElementById('rawTable').innerHTML = html;
    })();

    function toggleCollapse(el) {
      el.classList.toggle('open');
      el.nextElementSibling.classList.toggle('open');
    }
  </script>
</body>
</html>
